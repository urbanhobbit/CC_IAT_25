<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Implicit Comparison Test (Google Sheets)</title>
  <style>
    :root{
      --bg:#0b1020; --fg:#eef2ff; --muted:#94a3b8; --accent:#60a5fa; --error:#ef4444; --ok:#22c55e; --card:#121833; --bar:#1f2a4a; --barfill:#64748b;
    }
    html,body{height:100%;}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; background:var(--bg); color:var(--fg);}
    .app{max-width:760px;margin:0 auto;min-height:100%;display:flex;flex-direction:column;}
    header{padding:14px 16px;display:flex;justify-content:space-between;gap:12px;align-items:center;background:transparent;}
    .pill{background:var(--card);border:1px solid #1f2937;padding:8px 12px;border-radius:999px;font-size:14px;color:var(--muted);}
    .screen{flex:1;display:flex;flex-direction:column;gap:16px;padding:16px;}
    .labels{display:flex;justify-content:space-between;align-items:center;}
    .label{background:var(--card);border:1px solid #1f2937;width:49%;border-radius:16px;padding:12px 14px;min-height:56px;display:flex;flex-direction:column;justify-content:center}
    .label .title{font-size:13px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
    .label .value{font-weight:700;font-size:16px}
    .stimulus-wrap{position:relative;flex:1;display:flex;align-items:center;justify-content:center}
    .stimulus{font-size:40px;font-weight:800;letter-spacing:.02em;text-align:center}
    .errx{position:absolute;inset:0;display:none;align-items:center;justify-content:center;font-size:72px;color:white}
    .errx.show{display:flex;animation:pop .25s ease}
    .errx .x{background:rgba(239,68,68,.9);padding:4px 18px;border-radius:16px}
    @keyframes pop{from{transform:scale(.9);opacity:.6}to{transform:scale(1);opacity:1}}
    .progress{height:10px;background:var(--bar);border-radius:999px;overflow:hidden;border:1px solid #1f2937}
    .progress .fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#7c3aed);transition:width .25s ease}
    .zones{position:fixed;inset:0;display:none;z-index:10; touch-action:none;}
    .zones.active{display:flex}
    .zone{flex:1;background:transparent;border:0;appearance:none}
    .btn{background:var(--accent);color:#0b1020;border:0;padding:12px 16px;border-radius:14px;font-weight:700;cursor:pointer}
    .btn:disabled{background:var(--bar); color:var(--muted); cursor:not-allowed;}
    .btn.secondary{background:#1f2a4a;color:var(--fg);border:1px solid #374151}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:18px;padding:16px}
    .gauge{position:relative;height:18px;border-radius:999px;background:linear-gradient(90deg,#ef4444, #c084fc 50%, #22c55e);}
    .gauge .zero{position:absolute;left:50%;top:-8px;transform:translateX(-50%);font-size:12px;color:var(--muted)}
    .gauge .marker{position:absolute;top:-6px;width:2px;height:30px;background:#fff;border-radius:2px;transform:translateX(-50%)}
    .gauge .mean{position:absolute;top:-6px;width:2px;height:30px;background:#fde047;transform:translateX(-50%)}
    .transition-slide {position: absolute;inset: 0;display: none;align-items: center;justify-content: center;background: rgba(11, 16, 32, 0.85);z-index: 20;padding: 16px;text-align: center;}
    dialog{background:var(--card);color:var(--fg);border:1px solid #1f2937;border-radius:18px;max-width:560px;width:90%}
    dialog::backdrop{background:rgba(0,0,0,.55)}
    @media (max-width:420px){.stimulus{font-size:32px}}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="pill" id="phasePill">Ready</div>
      <div class="pill" id="trialPill">0 / 0</div>
    </header>
    <main class="screen">
      <div class="labels"><div class="label" id="leftLabel"><div class="title">Left</div><div class="value">—</div></div><div class="label" id="rightLabel"><div class="title">Right</div><div class="value">—</div></div></div>
      <div class="stimulus-wrap"><div class="stimulus" id="stimulus">Tap Start</div><div class="errx" id="errx"><div class="x">❌</div></div></div>
      <div class="progress"><div class="fill" id="progressFill"></div></div>
      <div class="card" id="ctaCard">
        <h3 style="margin:0 0 8px 0">Implicit Comparison Test (Gender & Occupations)</h3>
        <p style="margin:0 0 12px 0;color:var(--muted)">In this test, you will see words that represent career, family, MALE, and FEMALE. Respond by tapping, swiping, or using the Left/Right Arrow keys. Speed is important.</p>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" id="startBtn">Start Test</button>
          <button class="btn secondary" id="demoBtn">How to Play</button>
        </div>
      </div>
    </main>
  </div>
  <div class="transition-slide" id="transitionSlide"><div class="card"><h3 id="transitionTitle" style="margin-top:0;"></h3><p id="transitionText" style="color:var(--muted);line-height:1.6;"></p><div style="text-align:center;margin-top:20px;"><button class="btn" id="transitionContinueBtn">Continue</button></div></div></div>
  <div class="zones" id="zones"><button class="zone" id="zoneLeft" aria-label="Left response area" title="Left"></button><button class="zone" id="zoneRight" aria-label="Right response area" title="Right"></button></div>
  <dialog id="demoModal"><form method="dialog" style="margin:0"><div class="card" style="border:none"><h3 style="margin:0 0 8px 0">How to respond</h3><ol style="color:var(--muted);padding-left:18px;line-height:1.6"><li>Read the labels at the top (Left vs. Right).</li><li>When a word appears, tap or swipe the side it belongs to (or use the Left/Right Arrow keys).</li><li>If you make a mistake, a red ❌ appears. Quickly make the correct response to continue.</li><li>Go as fast as you can!</li></ol><div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px"><button class="btn">Got it</button></div></div></form></dialog>
  <dialog id="demographicsModal"><form method="dialog" id="demographicsForm" style="margin:0"><div class="card" style="border:none"><h3 style="margin:0 0 8px 0">A Couple of Questions</h3><p style="color:var(--muted);margin:0 0 16px 0;line-height:1.6">Your anonymous responses help researchers understand the results better. This is optional.</p><div style="display:flex;flex-direction:column;gap:12px;"><div><label for="genderSelect" style="display:block;margin-bottom:4px;color:var(--muted);font-size:14px;">Gender</label><select id="genderSelect" class="btn secondary" style="width:100%;text-align:left;"><option value="prefer_not_to_say">Prefer not to say</option><option value="male">Male</option><option value="female">Female</option><option value="non_binary">Non-binary</option><option value="other">Other</option></select></div><div><label for="ageInput" style="display:block;margin-bottom:4px;color:var(--muted);font-size:14px;">Age</label><input type="number" id="ageInput" placeholder="e.g., 25" class="btn secondary" style="width:100%;text-align:left;"></div></div><div style="display:flex;justify-content:flex-end;gap:8px;margin-top:20px"><button type="submit" class="btn">Start the Test</button></div></div></form></dialog>
  <dialog id="resultModal"><form method="dialog" style="margin:0"><div class="card" style="border:none"><h3 style="margin:0 0 6px 0">Your Result</h3><div id="resultSummary" style="margin:8px 0 12px 0;color:var(--muted)"></div><div class="gauge" id="gauge" aria-label="D-Score gauge" style="margin:10px 0 18px 0"><div class="zero">0</div><div class="marker" id="userMarker" style="left:50%"></div><div class="mean" id="meanMarker" style="left:50%"></div></div><div id="saveStatus" style="font-size:12px; color:var(--muted); text-align:center; margin-bottom:12px; min-height: 1em;"></div><div style="display:flex;gap:8px;flex-wrap:wrap"><button class="btn" id="downloadBtn" type="button">Download Raw Data</button><button class="btn secondary">Close</button></div></div></form></dialog>
  <script>
    // --- Google Sheets Configuration ---
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxW1x62P8oe0IO80E9n8ZGnIwLfbMBfkEtjHl-3oQWH8irGn8jStaEAK4-xb2N4iDZX/exec';
  
    // Main application code
    const CONFIG = {
      version: '2.3-google-sheets-90-trials',
      language: 'en',
      categories: { attribute: { left: 'Career', right: 'Family' }, concept: { left: 'MALE', right: 'FEMALE' } },
      stimuli: { career: ['office', 'manager', 'salary', 'job', 'briefcase', 'profession', 'employees'], family: ['garden', 'kitchen', 'marriage', 'laundry', 'home', 'children', 'relatives'], male: ['MAN', 'HE', 'HIM', 'BOY', 'HIS', 'GENT'], female: ['WOMAN', 'SHE', 'WOMEN', 'HER', 'GIRL', 'HERS', 'LADY'] },
      blocks: [
        { id: 'B-01', type: 'attribute', trials: 10 },
        { id: 'B-02', type: 'concept', trials: 10 },
        { id: 'B-03', type: 'combined-compatible', trials: 10 },
        { id: 'B-04', type: 'combined-compatible', trials: 20 },
        { id: 'B-05', type: 'reversed-concept', trials: 10 },
        { id: 'B-06', type: 'combined-incompatible', trials: 10 },
        { id: 'B-07', type: 'combined-incompatible', trials: 20 }
      ],
      benchmark: { mean: 0.31, sd: 0.12, n: 542 }
    };
    const TRANSITION_TEXTS = {
        'B-01': { title: 'Part 1 of 5', text: 'You will see words related to <b>Career</b> and <b>Family</b>.<br><br>Tap or swipe left (or Left Arrow) for <b>Career</b>.<br>Tap or swipe right (or Right Arrow) for <b>Family</b>.' },
        'B-02': { title: 'Part 2 of 5', text: 'Next, you will categorize words as <b>MALE</b> or <b>FEMALE</b>.<br><br>Tap or swipe left (or Left Arrow) for <b>MALE</b>.<br>Tap or swipe right (or Right Arrow) for <b>FEMALE</b>.' },
        'B-03': { title: 'Part 3 of 5', text: 'Now the categories are combined.<br><br>Tap or swipe left (or Left Arrow) for <b>MALE / Career</b>.<br>Tap or swipe right (or Right Arrow) for <b>FEMALE / Family</b>.' },
        'B-05': { title: 'Part 4 of 5', text: '<b>Watch out!</b> The positions have switched.<br><br>Tap or swipe left (or Left Arrow) for <b>FEMALE</b>.<br>Tap or swipe right (or Right Arrow) for <b>MALE</b>.' },
        'B-06': { title: 'Part 5 of 5', text: 'The categories are combined again.<br><br>Tap or swipe left (or Left Arrow) for <b>FEMALE / Career</b>.<br>Tap or swipe right (or Right Arrow) for <b>MALE / Family</b>.' }
    };
    const state = { trials: [], blockIndex: 0, trialIndex: 0, currentStimulus: null, expectKey: null, leftMapping: {}, rightMapping: {}, blockQueue: [], startTime: 0, accepting: false, reversedConcept: false, benchmark: { ...CONFIG.benchmark }, demographics: { age: null, gender: null }, armed: false, inErrorState: false };
    const el = id => document.getElementById(id);
    const phasePill = el('phasePill'), trialPill = el('trialPill'), leftLabel = el('leftLabel').querySelector('.value'), rightLabel = el('rightLabel').querySelector('.value'), stimulusEl = el('stimulus'), errx = el('errx'), progressFill = el('progressFill'), startBtn = el('startBtn'), demoBtn = el('demoBtn'), zones = el('zones'), demoModal = el('demoModal'), resultModal = el('resultModal'), resultSummary = el('resultSummary'), userMarker = el('userMarker'), meanMarker = el('meanMarker'), downloadBtn = el('downloadBtn'), ctaCard = el('ctaCard'), demographicsModal = el('demographicsModal'), demographicsForm = el('demographicsForm'), ageInput = el('ageInput'), genderSelect = el('genderSelect'), transitionSlide = el('transitionSlide'), transitionTitle = el('transitionTitle'), transitionText = el('transitionText'), transitionContinueBtn = el('transitionContinueBtn'), saveStatus = el('saveStatus');
    demoBtn.addEventListener('click', () => demoModal.showModal());
    startBtn.addEventListener('click', () => demographicsModal.showModal());
    demographicsForm.addEventListener('submit', (e) => { e.preventDefault(); state.demographics.age = ageInput.value ? parseInt(ageInput.value, 10) : null; state.demographics.gender = genderSelect.value; demographicsModal.close(); startTestSequence(); });
    function debugMsg(txt) { console.log('[ICT]', txt); phasePill.textContent = txt; }
    function armZones() { if (state.armed) return; state.armed = true; zones.classList.add('active'); let startX = 0, startY = 0, interactionStartTime = 0; const swipeThreshold = 50, tapMaxDist = 15, tapMaxTime = 250, verticalThreshold = 75; zones.addEventListener('pointerdown', (e) => { if (!e.isPrimary) return; e.preventDefault(); startX = e.clientX; startY = e.clientY; interactionStartTime = performance.now(); }); zones.addEventListener('pointerup', (e) => { if (!e.isPrimary || interactionStartTime === 0) return; const deltaTime = performance.now() - interactionStartTime; const deltaX = e.clientX - startX; const deltaY = e.clientY - startY; interactionStartTime = 0; if (Math.abs(deltaX) > swipeThreshold && Math.abs(deltaY) < verticalThreshold) { handleResponse(deltaX > 0 ? 'right' : 'left'); } else if (Math.abs(deltaX) < tapMaxDist && Math.abs(deltaY) < tapMaxDist && deltaTime < tapMaxTime) { handleResponse(e.clientX < window.innerWidth / 2 ? 'left' : 'right'); } }); debugMsg('Armed'); }
    window.addEventListener('keydown', (e) => { if (!state.accepting && !state.inErrorState) return; if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') { handleResponse('left'); } else if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'l') { handleResponse('right'); } });
    function shuffle(arr) { const a = [...arr]; for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[a[i], a[j]] = [a[j], a[i]]; } return a; }
    const now = () => performance.now();
    function showTransition(title, text) { return new Promise(resolve => { stimulusEl.style.visibility = 'hidden'; transitionTitle.innerHTML = title; transitionText.innerHTML = text; transitionSlide.style.display = 'flex'; const onContinue = () => { transitionSlide.style.display = 'none'; stimulusEl.style.visibility = 'visible'; transitionContinueBtn.removeEventListener('click', onContinue); armZones(); resolve(); }; transitionContinueBtn.addEventListener('click', onContinue); }); }
    function showErrorX() { errx.classList.add('show'); setTimeout(() => errx.classList.remove('show'), 250); }
    function updateProgress() { const totalTrials = CONFIG.blocks.reduce((s, b) => s + b.trials, 0); const done = state.blockQueue.slice(0, state.blockIndex).reduce((s, b) => s + b.trials, 0) + state.trialIndex; progressFill.style.width = (100 * done / totalTrials).toFixed(1) + '%'; trialPill.textContent = `${done} / ${totalTrials}`; }
    function setStatus(text) { phasePill.textContent = text; }
    async function startTestSequence() { try { ctaCard.style.display = 'none'; stimulusEl.textContent = 'Get ready…'; setStatus('Loading…'); state.blockQueue = CONFIG.blocks.map(b => ({ ...b })); state.blockIndex = 0; state.trialIndex = 0; state.trials = []; state.reversedConcept = false; debugMsg('Starting B-01'); await nextBlock(); } catch (err) { stimulusEl.textContent = 'Startup error: ' + (err && err.message ? err.message : String(err)); setStatus('Error'); console.error(err); } }
    function setLabels(mode) { const attr = CONFIG.categories.attribute; const concept = CONFIG.categories.concept; const conceptLeft = state.reversedConcept ? concept.right : concept.left; const conceptRight = state.reversedConcept ? concept.left : concept.right; if (mode === 'attribute') { state.leftMapping = { career: true }; state.rightMapping = { family: true }; leftLabel.textContent = attr.left; rightLabel.textContent = attr.right; } else if (mode === 'concept' || mode === 'reversed-concept') { state.leftMapping = state.reversedConcept ? { female: true } : { male: true }; state.rightMapping = state.reversedConcept ? { male: true } : { female: true }; leftLabel.textContent = conceptLeft; rightLabel.textContent = conceptRight; } else if (mode === 'combined-compatible') { state.leftMapping = { male: true, career: true }; state.rightMapping = { female: true, family: true }; leftLabel.textContent = `${concept.left} / ${attr.left}`; rightLabel.textContent = `${concept.right} / ${attr.right}`; } else if (mode === 'combined-incompatible') { state.leftMapping = { female: true, career: true }; state.rightMapping = { male: true, family: true }; leftLabel.textContent = `${conceptLeft} / ${attr.left}`; rightLabel.textContent = `${conceptRight} / ${attr.right}`; } }
    async function nextBlock() { if (state.blockIndex >= state.blockQueue.length) { return finishTest(); } const block = state.blockQueue[state.blockIndex]; if (TRANSITION_TEXTS[block.id]) { state.accepting = false; const { title, text } = TRANSITION_TEXTS[block.id]; await showTransition(title, text); } if (block.id === 'B-05') { state.reversedConcept = true; } setLabels(block.type); setStatus(`${block.id} • ${block.type.replace(/-/g, ' ')}`); let pool = []; if (block.type === 'attribute') { pool = [...CONFIG.stimuli.career.map(w => ({ t: w, c: 'career' })), ...CONFIG.stimuli.family.map(w => ({ t: w, c: 'family' }))]; } else if (block.type === 'concept' || block.type === 'reversed-concept') { const leftC = state.reversedConcept ? 'female' : 'male'; const rightC = state.reversedConcept ? 'male' : 'female'; pool = [...CONFIG.stimuli[leftC].map(w => ({ t: w, c: leftC })), ...CONFIG.stimuli[rightC].map(w => ({ t: w, c: rightC }))]; } else if (block.type.includes('combined')) { pool = [...CONFIG.stimuli.male.map(w => ({ t: w, c: 'male' })), ...CONFIG.stimuli.female.map(w => ({ t: w, c: 'female' })), ...CONFIG.stimuli.career.map(w => ({ t: w, c: 'career' })), ...CONFIG.stimuli.family.map(w => ({ t: w, c: 'family' }))]; } const trials = []; const shuffled = shuffle(pool); let idx = 0; for (let i = 0; i < block.trials; i++) { if (idx >= shuffled.length) { idx = 0; } trials.push(shuffled[idx++]); } block._trials = trials; state.trialIndex = 0; stimulusEl.textContent = '...'; setTimeout(nextTrial, 500); }
    function nextTrial() { const block = state.blockQueue[state.blockIndex]; if (state.trialIndex >= block._trials.length) { state.blockIndex++; updateProgress(); debugMsg('Next block'); nextBlock(); return; } const item = block._trials[state.trialIndex]; state.currentStimulus = item; const leftOk = !!state.leftMapping[item.c]; const rightOk = !!state.rightMapping[item.c]; state.expectKey = leftOk ? 'left' : (rightOk ? 'right' : null); if (!state.expectKey) { console.warn('No mapping for stimulus:', item); state.trialIndex++; nextTrial(); return; } stimulusEl.textContent = item.t; errx.classList.remove('show'); state.accepting = true; state.startTime = now(); updateProgress(); }
    function handleResponse(side) { if (state.inErrorState) { if (side === state.expectKey) { const penalty = 600; const totalTime = (now() - state.startTime) + penalty; const block = state.blockQueue[state.blockIndex]; logTrial(block, totalTime, 1, side); state.inErrorState = false; state.trialIndex++; nextTrial(); } return; } if (!state.accepting) return; state.accepting = false; const t = now() - state.startTime; const block = state.blockQueue[state.blockIndex]; const correct = (side === state.expectKey); if (correct) { logTrial(block, t, 0, side); state.trialIndex++; nextTrial(); } else { showErrorX(); state.inErrorState = true; } }
    function logTrial(block, rt, error, side) { const extreme = (rt < 300 || rt > 10000) ? 1 : 0; state.trials.push({ ts: Date.now(), block: block.id, blockType: block.type, stimulus: state.currentStimulus.t, category: state.currentStimulus.c, expect: state.expectKey, key: side, correct: error ? 0 : 1, error, rt: Math.round(rt), extreme }); }
    async function finishTest() { const crit = state.trials.filter(r => (r.block === 'B-04' || r.block === 'B-07')).filter(r => !r.extreme); const block4_rts = crit.filter(r => r.block === 'B-04').map(r => r.rt); const block7_rts = crit.filter(r => r.block === 'B-07').map(r => r.rt); const m4 = mean(block4_rts); const m7 = mean(block7_rts); const sd4 = stdev(block4_rts); const sd7 = stdev(block7_rts); const pooled_sd = Math.sqrt(((sd4 ** 2) + (sd7 ** 2)) / 2) || 1; const D = (m7 - m4) / pooled_sd; showResult(D); persistToLocalStorage(); if (GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL !== 'PASTE_YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') { saveStatus.textContent = "Saving results..."; const payload = { createdAt: new Date().toISOString(), demographics: state.demographics, computed: { D, mean_compatible: m4, mean_incompatible: m7, pooled_sd }, trials: state.trials }; try { const response = await fetch(GOOGLE_SCRIPT_URL, { method: "POST", mode: "no-cors", cache: "no-cache", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) }); saveStatus.textContent = "Anonymous results saved. Thank you!"; } catch (err) { saveStatus.style.color = "var(--error)"; saveStatus.textContent = "Could not save results online."; console.error("Error saving to Google Sheets:", err); } } }
    function mean(a) { return a.length ? a.reduce((s, x) => s + x, 0) / a.length : 0; }
    function stdev(a) { if (a.length < 2) return 0; const m = mean(a); return Math.sqrt(a.reduce((s, x) => s + (x - m) ** 2, 0) / (a.length - 1)); }
    function persistToLocalStorage() { try { const key = `ict_gender_trials_${Date.now()}`; localStorage.setItem(key, JSON.stringify({ meta: { version: CONFIG.version, lang: CONFIG.language }, demographics: state.demographics, benchmark: state.benchmark, trials: state.trials })); } catch (_) { console.warn('Could not save raw data to localStorage.'); } }
    function showResult(D) { const { mean: GM, sd: SD, n: N } = state.benchmark; const summary = [`Your D-Score: <b>${D.toFixed(2)}</b>`, `Population mean: <b>${GM.toFixed(2)}</b> (SD = ${SD.toFixed(2)}, n = ${N})`, interp(D)].join('<br>'); resultSummary.innerHTML = summary; const pos = pctFromD(D); const meanPos = pctFromD(GM); userMarker.style.left = pos + '%'; meanMarker.style.left = meanPos + '%'; try { resultModal.showModal(); } catch (e) { console.error("Result modal could not be shown:", e); } saveStatus.textContent = ''; saveStatus.style.color = 'var(--muted)'; downloadBtn.onclick = () => downloadJSON(`ict_gender_raw_${Date.now()}.json`, { demographics: state.demographics, benchmark: state.benchmark, computed: { D, GM, SD, N }, trials: state.trials }); }
    function pctFromD(d) { const clamped = Math.max(-1, Math.min(1, d)); return ((clamped + 1) / 2) * 100; }
    function interp(D) { let label, txt; if (D > 0.35) { label = 'Moderate stereotype'; txt = 'Indicates a moderate implicit association of Male with Career and Female with Family.'; } else if (D > 0.15) { label = 'Slight stereotype'; txt = 'Indicates a slight implicit association of Male with Career and Female with Family.'; } else if (D > -0.15) { label = 'Neutral'; txt = 'Indicates little to no implicit stereotype.'; } else if (D > -0.35) { label = 'Slight stereotype (reversed)'; txt = 'Indicates a slight implicit association of Female with Career and Male with Family.'; } else { label = 'Moderate stereotype (reversed)'; txt = 'Indicates a moderate implicit association of Female with Career and Male with Family.'; } return `<span style="color:var(--muted)">${label}: ${txt}</span>`; }
    function downloadJSON(filename, data) { const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url); }
  </script>
</body>
</html>
